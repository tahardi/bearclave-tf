write_files:
  - path: /etc/docker/daemon.json
    content: |
      {
        "log-driver": "json-file",
        "log-opts": {
          "max-size": "10m",
          "max-file": "3"
        }
      }

runcmd:
  # Ensure TDX device and kernel config are mounted before container starts
  - mount --bind /dev/tdx-guest /dev/tdx-guest
  - mount --bind /sys/kernel/config /sys/kernel/config
  # Pull and run your container with mounted volumes
  - docker pull ${container_image}
  - docker run -d \
    --privileged \
    --name bearclave \
    -v /dev/tdx-guest:/dev/tdx-guest \
    -v /sys/kernel/config:/sys/kernel/config \
    ${container_image}
